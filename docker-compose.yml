version: "3.8"

services:
  frontend:
    build:
      context: .
      args:
        VITE_BASE_URL: ${VITE_BASE_URL}
    ports:
      - "5173:5173"
    environment:
      - NODE_ENV=production
  
  dashboard:
     build: .
     container_name: dashboard
     restart: unless-stopped
     expose:
      - "80"   # internal only, Traefik will map to it
     labels:
      - "traefik.enable=true"
      - "traefik.http.routers.dashboard.rule=Host(`dashboard.georankers.co`)"
      - "traefik.http.routers.dashboard.entrypoints=websecure"
      - "traefik.http.routers.dashboard.tls.certresolver=letsencrypt"
      - "traefik.http.services.dashboard.loadbalancer.server.port=80"
      # HTTP to HTTPS redirect
      - "traefik.http.routers.dashboard-http.rule=Host(`dashboard.georankers.co`)"
      - "traefik.http.routers.dashboard-http.entrypoints=web"
      - "traefik.http.routers.dashboard-http.middlewares=redirect-to-https"
      - "traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https"

networks:
  default:
    external: true
    name: redora-backend_default
